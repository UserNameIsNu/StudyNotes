[TOC]

# Maven

# 1，简介

## 1.这是啥

Java 的项目管理工具。

用于规范化项目结构，尤其是管理三方依赖。

## 2.GAV坐标

（啥玩意乱七八糟的鬼名字）。

就是Maven用来整理不同三方包的手段（整理文件夹）。

就是三个地址。

G：group，组地址，如可以给所有类型的数据库分为一组，或某个团队所有的项目分为一组。

A：artifactld，产物，这个组中的某个项目。

V：version，版本，这个项目的版本。

# 2，使用

## 1.安装

去 apache 官网，有很多开源项目的：[Download Apache Maven – Maven](https://maven.apache.org/download.cgi)。

下载编译版（Binary）zip 后缀。

直接解压就行。

## 2.结构

![image-20250410191410932](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410191410932.png)

上面三个文件就是啥开源协议，使用须知之类的，不用管（上了Git的项目几乎都有的，看不看随便）。

bin：运行脚本。

boot：类加载器框架（听不懂）。

conf：配置。

lib：Maven自己需要的三方包。

除了 conf 里面有个 settings.xml 文件要带走，其它都不用管。

贴走 settings.xml，剩下的删了都可以了。

新建一个文件夹（就是将来的本地Maven仓库，所有用Maven下载的三方包都在这里）。

把 settings.xml 贴进去。

## 3.配置IDEA

### 项目预设

反正我写 Java 就用 IDEA。

随便打开一个项目跟着图片做。

![image-20250410192335949](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410192335949.png)

就动这俩地址就好。

第一个就是刚才配置的Maven本地仓库地址中的配置文件。

第二个就是仓库地址。

![image-20250410192425362](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410192425362.png)

这样以后用IDEA创建Maven项目时，都会使用这个仓库了。

### 已有项目

但如果需要修改已有的Maven项目的仓库路径。

也是跟着下面图片走。

打开项目设置。

![image-20250410193720849](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410193720849.png)

然后就进到这里。

还是改一样的地方。

![image-20250410193755632](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410193755632.png)

## 4.项目中导入三方包

IDEA创建Maven项目后，一定会有一个pom.xml文件。

三方包的依赖可以去Maven中央仓库找：[Maven Repository: Search/Browse/Explore](https://mvnrepository.com/)。

搜需要的三方包名字就好（有的话）。

![image-20250410194333231](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410194333231.png)

点击进去需要的包。

选择版本。

![image-20250410194442935](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410194442935.png)

进去就有Maven用的xml配置了。

![image-20250410194600015](D:\plan of electronic hamster\6，Study notes\07 --- Meven✅\img\image-20250410194600015.png)

记得IDEA的xml配置完之后就可以点右上角的蓝色小圈刷新了。

Maven就会自动下载依赖了。

这堆东西放哪里看下面的pom.xml的结构示例。

# 3，两个重要的文件

## 1.setting.xml

就是Maven的配置文件。

里面东西有点多，自己去百度。

## 2.pom.xml

项目的依赖管理文件。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <!--  pom版本  -->
    <modelVersion>4.0.0</modelVersion>

    <!--  这个项目的GAV坐标（文件夹层级）  -->
    <groupId>org.example</groupId>
    <artifactId>untitled</artifactId>
    <version>1.0-SNAPSHOT</version>

    <!--  打包方法  -->
    <!--  默认jar，还有war和pom  -->
    <!--  Java项目，Web项目，原料项目  -->
    <packaging>war</packaging>

    <!--  属性配置  -->
    <properties>
        <!--  内置属性  -->
        <!--  编译用JDK版本  -->
        <maven.compiler.source>21</maven.compiler.source>
        <!--  编译后字节码版本  -->
        <maven.compiler.target>21</maven.compiler.target>
        <!--  编码  -->
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

        <!--  自定义属性  -->
        <servlet.version>6.1.0</servlet.version>
    </properties>

    <!--  依赖配置  -->
    <dependencies>
        <!--  依赖1  -->
        <!-- https://mvnrepository.com/artifact/jakarta.servlet/jakarta.servlet-api -->
        <dependency>
            <groupId>jakarta.servlet</groupId>
            <artifactId>jakarta.servlet-api</artifactId>
            <!--  <version>6.1.0</version>  -->
            <version>${servlet.version}</version>
            <scope>provided</scope>
        </dependency>

        <!--  依赖2  -->
        <!--  ...  -->
    </dependencies>
</project>
```

# 4，依赖传递

## 1.常规依赖

用Maven导入三方包时，会自动向下寻找相应的其它三方包的依赖。

如包A需要包B，Maven就会自动把包B也一起打上。

## 2.交叉依赖

一个包需要其它包的支持，这一串的引用就叫依赖链。

交叉依赖就是多个依赖链同时引用了相同的包（这个包版本可能不同）。

```
A -> B -> C1.0
B -> C2.0
C3.0
这里第三个C会优先被使用。
```

若路径层级相同，谁先被调用就用谁。

```
A -> B -> C1.0
B -> D -> C2.0
这里第二个C会优先被使用。
```

## 3.依赖排除

私人老师讲太快了，生怕被我们学到了。

反正这玩意一般不用管，Maven似乎会自己操作的。

## 4.可选依赖

可以打断依赖链。

用 `<optional>true</optional>` 定义。

```
A -> B -> C1.0
给B加上，C就不会被依赖进来
```

```xml
<dependency>
    <groupId>jakarta.servlet</groupId>
    <artifactId>jakarta.servlet-api</artifactId>
    <version>6.1.0</version>
    <optional>true</optional>
</dependency>
```

## 5.依赖范围

用 `<scope></scope>` 定义。

```xml
<dependency>
    <groupId>jakarta.servlet</groupId>
    <artifactId>jakarta.servlet-api</artifactId>
    <version>6.1.0</version>
    <scope>provided</scope>
</dependency>
```

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| compile  | 在编译，测试，运行时都需要，默认。                           |
| test     | 测试时需要。编译和运行不需要。（例如：Junit）。              |
| runtime  | 测试和运行时需要。编译不需要。（例如：JDBC驱动）。           |
| provided | 编译和测试时需要。运行时不需要，由运行环境提供。（例如：servlet-api）。 |
| system   | 本地依赖，不在maven中央仓库。                                |

# 5，生命周期

## 1.三个周期

### 清理周期

构建前的准备周期。

| 阶段       | 说明                     |
| ---------- | ------------------------ |
| pre-clean  | 执行清理前需要完成的工作 |
| clean      | 清理上一次构建生成的文件 |
| post-clean | 执行清理后需要完成的工作 |

### 构建周期

核心周期。

负责项目的验证、初始化到项目的编译、测试、部署、打包等。

（这玩意真™忙）。

| 阶段                    | 说明                                                         |
| ----------------------- | ------------------------------------------------------------ |
| validate                | 验证项目是否正确和所有需要的相关资源是否可用                 |
| initialize              | 初始化构建                                                   |
| generate-sources        | 为包含在编译范围内的代码生成源代码                           |
| process-sources         | 处理源代码                                                   |
| generate-resources      | 生成资源文件                                                 |
| compile                 | 编译项目的源代码                                             |
| process-classes         | 为编译生成的class文件做后期工作                              |
| generate-test-sources   | 为编译内容生成测试源代码                                     |
| process-test-source     | 处理测试源代码                                               |
| generate-test-resources | 生成测试所需的资源文件                                       |
| process-test-resources  | 复制并处理资源文件，至目标测试目录                           |
| test-compile            | 编译测试源代码                                               |
| process-test-classes    | 为编译生成测试的class文件做后期处理工作                      |
| test                    | 使用合适的单元测试框架运行测试。这些测试代码不会被打包或部署 |
| prepare-package         | 执行打包前的预处理工作                                       |
| package                 | 接受编译好的代码，打包成可发布的格式，如 jar或war            |
| pre-integration-test    | 预集成测试                                                   |
| integration-test        | 按需求将发布包部署到运行测试环境                             |
| post-integration-test   | 执行整合测试                                                 |
| verify                  | 验证包是否有效并符合标准                                     |
| install                 | 将包安装至本地仓库                                           |
| deploy                  | 将最终的包发布到远程的仓库                                   |

### 部署周期

用于生成项目报告，站点，发布站点。

| 阶段        | 说明                                                       |
| ----------- | ---------------------------------------------------------- |
| pre-site    | 执行一些需要在生成站点文档之前完成的工作                   |
| site        | 生成项目的站点文档                                         |
| post-site   | 执行一些需要在生成站点文档之后完成的工作，并且为部署做准备 |
| site-deploy | 将生成的站点文档部署到特定的服务器上                       |

## 2.单独使用

三个周期中的每个阶段均为一个类似脚本的玩意，他们叫插件。

都可以单独调用。

例如直接打包。

```powershell
mvn package
```

# 6，案例

## 1.项目父模块pom配置

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <!--  pom版本  -->
    <modelVersion>4.0.0</modelVersion>

    <!--  这个项目的GAV坐标（文件夹层级）  -->
    <groupId>org.example</groupId>
    <artifactId>untitled</artifactId>
    <version>1.0-SNAPSHOT</version>

    <!--  打包方法  -->
    <!--  默认jar，还有war和pom  -->
    <!--  Java项目，Web项目，原料项目  -->
    <packaging>pom</packaging>

    <!--  包含的子模块  -->
    <modules>
        <module>untitled-entity</module>
        <module>untitled-dao</module>
        <module>untitled-service</module>
        <module>untitled-common</module>
        <module>untitled-web</module>
    </modules>

    <!--  属性配置  -->
    <properties>
        <!--  内置属性  -->
        <!--  编译用JDK版本  -->
        <maven.compiler.source>21</maven.compiler.source>
        <!--  编译后字节码版本  -->
        <maven.compiler.target>21</maven.compiler.target>
        <!--  编码  -->
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

        <!--  自定义属性  -->
        <servlet.version>6.1.0</servlet.version>
        <mysql.version>8.3.0</mysql.version>
        <gson.version>2.13.0</gson.version>
    </properties>

    <!--  仅用于父模块的依赖管理  -->
    <dependencyManagement>
        <!--  依赖列表  -->
        <dependencies>
            <!--  依赖1  -->
            <!--  servlet-api  -->
            <dependency>
                <groupId>jakarta.servlet</groupId>
                <artifactId>jakarta.servlet-api</artifactId>
                <version>${servlet.version}</version>
            </dependency>
            <!--  依赖2  -->
            <!--  mysql-driver  -->
            <dependency>
                <groupId>com.mysql</groupId>
                <artifactId>mysql-connector-j</artifactId>
                <version>${mysql.version}</version>
            </dependency>
            <!--  依赖3  -->
            <!--  gson  -->
            <dependency>
                <groupId>com.google.code.gson</groupId>
                <artifactId>gson</artifactId>
                <version>${gson.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

## 2.项目子模块pom配置

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <!--  父模块坐标  -->
    <parent>
        <groupId>org.example</groupId>
        <artifactId>untitled</artifactId>
        <version>1.0-SNAPSHOT</version>
    </parent>

    <!--  模块ID  -->
    <artifactId>untitled-service</artifactId>

    <packaging>jar</packaging>

    <dependencies>
        <!--  因为继承父模块，引用的包父模块定义过了，这里仅需要说明我要用，用什么版本按父模块的来  -->
        <dependency>
            <groupId>com.google.code.gson</groupId>
            <artifactId>gson</artifactId>
        </dependency>
        <dependency>
            <groupId>jakarta.servlet</groupId>
            <artifactId>jakarta.servlet-api</artifactId>
        </dependency>
        <!--  引用另外两个子模块  -->
        <dependency>
            <groupId>org.example</groupId>
            <artifactId>untitled-dao</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>org.example</groupId>
            <artifactId>untitled-common</artifactId>
            <version>${project.version}</version>
        </dependency>
    </dependencies>

    <properties>
        <maven.compiler.source>21</maven.compiler.source>
        <maven.compiler.target>21</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>

</project>
```

