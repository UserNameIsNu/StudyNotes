[TOC]

# LogBack

# 1，简介

## 1.这是啥

开源的，高性能的，免费的，Java中用的挺多的一个日志框架。

帮你System.out.print的玩意。

SpringBoot似乎默认也是用这个做日志输出的。

# 2，使用

## 1.控制台日志

还是用Meven导入LogBack依赖就行，不啰嗦了。

### xml配置

再有就是LogBack的配置文件（一般）长下面这样。

放在resource下，就叫logbakc.xml就行。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!--
    scan为true时，若文件发生改变，则将会自动刷新
    scanPeriod为扫描间隔
    debug为是否打印logback内部日志（一般只输出程序的日志，没有这个日志框架本身的日志）
  -->
<configuration scan="true" scanPeriod="60 seconds" debug="false">
    <!--  用于指定日志的输出类型（控制台，文件，数据库等）  -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <!--
                指定日志的编码与输出格式
                %d：指定日期格式
                %t：显示当前执行日志输出工作的线程名称
                %p：显示日志级别
                %C（大写）：输出日志所在的类的完整类名
                %m：日志消息
                %n：换行
              -->
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%t] %p %C - %m%n</pattern>
        </encoder>
    </appender>

    <!--
        配置logger的根，指定输出级别
        输出级别（小到大）：TRACE < DEBUG < INFO < WARN < ERROR
        在日志输出时仅会输出大于等于根级别的日志条目
    -->
    <root level="debug">
        <appender-ref ref="console"/>
    </root>
</configuration>
```

### 使用

这套配置就是最基本的，喷到控制台用的。

声明一个Logger出来直接调它方法喷就行。

```java
package edu.nf.ch01;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Main {
    private final static Logger logger = LoggerFactory.getLogger(Main.class);

    public static void main(String[] args) {
        logger.trace("trace:{}", 1);
        logger.debug("debug:{}", 2);
        logger.info("info:{}", 3);
        logger.warn("warn:{}", 4);
        logger.error("error:{}", 5);
    }
}
```

## 2.文件日志

这个就是把日志输出到日志文件（.log）里面的。

### xml配置

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!--  输出到控制台  -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%t] %highlight(%p) %C（Line:%L） - %m%n</pattern>
        </encoder>
    </appender>

    <!--  输出到文件  -->
    <appender name="file" class="ch.qos.logback.core.FileAppender">
        <!--  指定输出的目标文件（路径可以是相对也可以是绝对）  -->
        <file>ch02/logs/test.log</file>
        <!--  表示每条新日志追加至文件末尾（false就是覆盖）  -->
        <append>true</append>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%t] %p %C（Line:%L） - %m%n</pattern>
        </encoder>
    </appender>

    <root level="debug">
        <appender-ref ref="console"/>
        <appender-ref ref="file"/>
    </root>
</configuration>
```

### 使用

和控制台日志基本一样。

```java
package edu.nf.ch02;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Main {
    private final static Logger logger = LoggerFactory.getLogger(Main.class);

    public static void main(String[] args) {
        logger.trace("trace:{}", 1);
        logger.debug("debug:{}", 2);
        logger.info("info:{}", 3);
        logger.warn("warn:{}", 4);
        logger.error("error:{}", 5);
    }
}
```

## 3.滚动日志（条件日志）

也是文件日志的一种。

可以按照一定的条件生成日志。

### xml配置

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%t] %highlight(%p) %C（Line:%L） - %m%n</pattern>
        </encoder>
    </appender>

    <!--  滚动日志  -->
    <appender name="file" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!--   配置滚动策略（如每天开一个新日志文件，或一个文件装满到多少MB就开个新的等）   -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!--  指定生成的文件名  -->
            <fileNamePattern>ch03/logs/%d{yyyy-MM-dd}.log</fileNamePattern>
            <!--  保留归档文件的最大数量，这里意为仅保留最近30份日志文件  -->
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%t] %p %C（Line:%L） - %m%n</pattern>
        </encoder>
    </appender>

    <root level="debug">
        <appender-ref ref="console"/>
        <appender-ref ref="file"/>
    </root>
</configuration>
```

### 使用

还是一样的。

```java
package edu.nf.ch03;

import lombok.extern.slf4j.Slf4j;

@Slf4j
public class Main {
    public static void main(String[] args) {
        log.trace("trace:{}", 1);
        log.debug("debug:{}", 2);
        log.info("info:{}", 3);
        log.warn("warn:{}", 4);
        log.error("error:{}", 5);
    }
}
```

## 4.SB集成

SpringBoot里面就有LogBack这玩意（SB自己的日志好像也用的是这玩意）。

一般创建SB项目时就可以直接选择加入LogBack依赖，让IDE和SB全部处理好（自己去Meven里面赖也是可以的）。

### 启用LogBack

去SB的启动类里面打上@slf4j的注解（这玩意是被百花齐放的日志框架逼出来的统一接口规范）。

LogBack也是实现了slf4j的接口。

打上这个注解后在框架中似乎就是可以到处拍日志输出了。

```java
package edu.nf.ch01;

import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@Slf4j
public class Ch01Application {

    public static void main(String[] args) {
        SpringApplication.run(Ch01Application.class, args);
        log.info("!");
    }

}
```

### 配置LogBack

配置这玩意的工作也是被application.properties承接了。

不用在resource里面单开一个logback.xml了。

```properties
spring.application.name=ch01

# 控制台日志的输出格式
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%t] %highlight(%p) %C?Line:%L? - %m%n
# 文件日志的输出格式
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%t] %p %C?Line:%L? - %m%n
# 输出级别
logging.level.root=info
# 文件日志的存放地址与文件名
logging.file.name=logs/testLog.log
# 滚动日志策略：单个文件日志最大大小
logging.logback.rollingpolicy.max-file-size=1KB
# 滚动日志策略：最大保留最新文件日志数量
logging.logback.rollingpolicy.max-history=7
```

