[TOC]

# Vue3

# 1ï¼Œç®€ä»‹

## 1. è¿™æ˜¯å•¥

Vue 3 æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼ JavaScript æ¡†æ¶ã€‚

å®ƒåŸºäºç»„ä»¶åŒ–å’Œå“åº”å¼æ•°æ®çš„ç†å¿µï¼Œæä¾›äº†ä¸€ç§ç®€å•é«˜æ•ˆçš„æ–¹å¼æ¥æ„å»ºç”¨æˆ·ç•Œé¢ã€‚

ç®€å•è¯´å°±æ˜¯æ¨¡å—åŒ–ï¼Œæ•´æ´ï¼Œå¿«é€Ÿçš„æ„å»ºå‰ç«¯é¡¹ç›®ã€‚

å°±æ˜¯è¯­æ³•çœ‹çš„çŠ¯æ¶å¿ƒï¼ˆæˆ‘ä¸å‰ç«¯ä¸å…±æˆ´å¤©ï¼‰ã€‚

## 2. äº”ä¸ªç‰¹ç‚¹

- **Composition API** ï¼šè¿™æ˜¯ Vue 3 æœ€é‡è¦çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œæä¾›äº†ä¸€ç§æ›´çµæ´»ã€æ›´å¼ºå¤§çš„æ–¹å¼æ¥ç»„ç»‡å’Œå¤ç”¨ç»„ä»¶çš„é€»è¾‘ã€‚ä¸ Vue 2 ä¸­çš„ Options API ç›¸æ¯”ï¼ŒComposition API å…è®¸å¼€å‘è€…å°†ç»„ä»¶çš„é€»è¾‘æ‹†åˆ†ä¸ºå¯å¤ç”¨çš„å‡½æ•°ï¼Œä½¿å¾—ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå°¤å…¶é€‚ç”¨äºå¤æ‚ç»„ä»¶çš„å¼€å‘ã€‚
- **å“åº”å¼ç³»ç»Ÿæ”¹è¿›** ï¼šVue 3 å¯¹å“åº”å¼ç³»ç»Ÿè¿›è¡Œäº†é‡æ„ï¼Œå¼•å…¥äº†åŸºäº Proxy çš„å“åº”å¼å®ç°ï¼Œå–ä»£äº† Vue 2 ä¸­çš„ Object.defineProperty æ–¹æ³•ã€‚è¿™ä½¿å¾—å“åº”å¼ç³»ç»Ÿæ›´åŠ é«˜æ•ˆã€çµæ´»ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒåµŒå¥—å¯¹è±¡å’Œæ•°ç»„çš„å“åº”å¼æ“ä½œã€‚
- **æ€§èƒ½æå‡** ï¼šVue 3 åœ¨æ¸²æŸ“æ€§èƒ½ã€å†…å­˜å ç”¨ç­‰æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡æ–°çš„è™šæ‹Ÿ DOM å®ç°å’Œç¼–è¯‘ä¼˜åŒ–ï¼Œå‡å°‘äº†è¿è¡Œæ—¶çš„å¼€é”€ï¼Œæé«˜äº†ç»„ä»¶çš„æ¸²æŸ“é€Ÿåº¦ã€‚
- **æ›´å¥½çš„ TypeScript æ”¯æŒ** ï¼šVue 3 å¯¹ TypeScript çš„æ”¯æŒå¾—åˆ°äº†æå¤§å¢å¼ºï¼Œæä¾›äº†æ›´å¥½çš„ç±»å‹æ¨æ–­å’Œç±»å‹æ£€æŸ¥ï¼Œä½¿å¾—ä½¿ç”¨ TypeScript å¼€å‘ Vue åº”ç”¨æ›´åŠ é¡ºç•…å’Œå®‰å…¨ã€‚
- **æ–°ç‰¹æ€§ä¸ä¼˜åŒ–** ï¼šè¿˜å¼•å…¥äº†è®¸å¤šå…¶ä»–æ–°ç‰¹æ€§ï¼Œå¦‚ fragmentã€teleportã€provide/inject çš„ä¼˜åŒ–ã€å…¨å±€ API çš„é‡æ„ç­‰ï¼Œè¿›ä¸€æ­¥æå‡äº†å¼€å‘ä½“éªŒå’Œåº”ç”¨æ€§èƒ½ã€‚

## 3. åˆ›å»ºé¡¹ç›®

å…ˆå»ä¸‹è½½ä¸€ä¸ª Node.jsã€‚

è‡ªå·±å»æŸ¥æŸ¥æ€ä¹ˆè£…ã€‚

å‘½ä»¤è¡Œèƒ½æŸ¥å‡ºä¸‹é¢è¿™ä¿©ä¸œè¥¿çš„ç‰ˆæœ¬å°±è¡Œäº†ã€‚

```powershell
node --version
```

```powershell
npm --version
```

ç„¶ååœ¨éœ€è¦åˆ›å»º Vue é¡¹ç›®çš„åœ°æ–¹åŸåœ°æ‰“å¼€å‘½ä»¤è¡Œã€‚

ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºé¡¹ç›®ã€‚

```powershell
npm create vue@latest
```

å¯èƒ½ä¼šæç¤ºï¼š

```powershell
Need to install the following packages:
create-vue@3.16.4
Ok to proceed? (y) 
```

è¾“å…¥ y å°±è¡Œï¼Œå°±æ˜¯æç¤ºä½ éœ€è¦å®‰è£… Vue ç½¢äº†ã€‚

ç„¶åä¼šæç¤ºç»™é¡¹ç›®æ­é…ä¸€äº›é¢å¤–çš„ä¸œè¥¿ã€‚

é€‰ä¸€ä¸ª TS æ”¯æŒå°±è¡Œäº†ã€‚

å‰©ä¸‹çš„å°±è·Ÿç€æç¤ºæ“ä½œï¼Œç„¶åç†åº”å°±åˆ›å»ºå¥½ä¸€ä¸ª Vue3 é¡¹ç›®äº†ã€‚

## 4. é¡¹ç›®ç»“æ„

ä¸»è¦å…³æ³¨ src / ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚

æ–°åŠŸèƒ½å¼€å‘ä¸»è¦åœ¨ components / ç›®å½•ä¸‹è¿›è¡Œã€‚

éœ€è¦æ·»åŠ æ–°ä¾èµ–æ—¶æŸ¥çœ‹ package.jsonã€‚

éœ€è¦é…ç½®å…¨å±€è®¾ç½®æ—¶æŸ¥çœ‹ main.tsã€‚

éœ€è¦ä¿®æ”¹æ„å»ºé…ç½®æ—¶æŸ¥çœ‹ vite.config.tsã€‚

åæ­£å§ï¼Œå¼€å‘ vue3 æ—¶ä¸€èˆ¬å¤§éƒ¨åˆ†æ—¶é—´å°±æ˜¯åœ¨ src æ–‡ä»¶å¤¹ä¸­ã€‚

å°¤å…¶æ˜¯ components ç»„ä»¶æ–‡ä»¶å¤¹ä¸­æŠ˜è…¾ã€‚

### å¸¸ç”¨ç›®å½•

#### src

æ ¸å¿ƒç›®å½•ã€‚

åŒ…å«æ‰€æœ‰ä¸»è¦ä¸šåŠ¡é€»è¾‘ã€‚

#### src / components

ç»„ä»¶ç›®å½•ã€‚

æ¯ä¸ªæ–°åŠŸèƒ½å°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª .vue æ–‡ä»¶ã€‚

#### src / assets

èµ„æºç›®å½•ã€‚

å›¾ç‰‡æ ·å¼å•¥çš„éƒ½æ”¾è¿™é‡Œã€‚

### å¸¸ç”¨æ–‡ä»¶

#### src / App.vue

æ ¹ç»„ä»¶ã€‚

å®šä¹‰åº”ç”¨çš„åŸºæœ¬å¸ƒå±€ã€‚

#### src / main.ts

åº”ç”¨å…¥å£ã€‚

é…ç½®å…¨å±€æ’ä»¶ä¸åˆå§‹åŒ–åº”ç”¨ã€‚

#### package.json

é¡¹ç›®ç®¡ç†ã€‚

ç®¡ç†é¡¹ç›®çš„ä¾èµ–ï¼Œå¹¶å®šä¹‰é¡¹ç›®è„šæœ¬å‘½ä»¤ã€‚

### é…ç½®æ–‡ä»¶

#### vite.config.ts

æ„å»ºé…ç½®ã€‚

é…ç½®å¼€å‘æœåŠ¡å™¨ä¸æ„å»ºé€‰é¡¹ã€‚

#### tsconfig.json

TS é…ç½®ã€‚

å­—é¢æ„æ€ï¼Œä¸€èˆ¬åç»­å¼€å‘æ—¶ä¸ç”¨ç®¡å®ƒã€‚

### å…¶å®ƒæ–‡ä»¶

#### index.html

é¡¹ç›® HTML å…¥å£ã€‚

#### public

é™æ€èµ„æºç›®å½•ã€‚

æ”¾ç½®ä¸ç”¨æ„å»ºçš„èµ„æºï¼Œå¦‚ç½‘ç«™å›¾æ ‡å•¥çš„ã€‚

## 5. å¯åŠ¨é¡¹ç›®

æ‰“å¼€æ§åˆ¶å°è¾“å…¥ä¸‹é¢çš„å‘½ä»¤å›è½¦ã€‚

```powershell
npm install
```

ç„¶åæ§åˆ¶å°ç†åº”ä¼šå¼€å§‹è½¬åœˆåœˆã€‚

ç­‰ä¸€ä¼šå„¿ï¼Œé¡¹ç›®ä¸­å‡ºç° node_modules åçœ‹æ§åˆ¶å°ç»“æŸè¿è¡Œäº†å°±ç®—æ˜¯å¯ä»¥äº†ã€‚

ï¼ˆè¦ç½‘çš„ï¼‰ã€‚

ç„¶åç»§ç»­è¾“å…¥ã€‚

```powershell
npm run dev
```

è‹¥æ§åˆ¶å°è¹¦å‡ºæ¯«ç§’å•ä½çš„åŠ è½½æ—¶é—´ï¼Œä¸”å‡ºç°äº† url åœ°å€ï¼Œé‚£ä¹ˆå°±ç®—æ˜¯å¯åŠ¨æˆåŠŸäº†ã€‚

è¿›å…¥ Local çš„åœ°å€å³å¯ã€‚

# 2ï¼ŒåŸºç¡€

## 1. ä¸‰ä¸ªåŸºç¡€ç»„æˆ

### Vue å®ä¾‹

è¿™æ˜¯æ•´ä¸ª vue é¡¹ç›®çš„å…¥å£ä¸ç®¡ç†æ ¸å¿ƒã€‚

ä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹ã€‚

```typescript
import { createApp } from 'vue' // å¯¼å…¥ createApp å‡½æ•°
import App from './App.vue' // å¯¼å…¥æ ¹ç»„ä»¶

const app = createApp(App) // ä½¿ç”¨ createApp å‡½æ•°åˆ›å»ºåº”ç”¨å®ä¾‹

app.mount('#app') // æŒ‚è½½åº”ç”¨å®ä¾‹åˆ° DOM ä¸­çš„ app å…ƒç´ 
```

### App.vue

æ•´ä¸ªé¡¹ç›®çš„æ ¹ç»„ä»¶ã€‚

å±€éƒ¨ç»„ä»¶å°±éœ€è¦åœ¨è¿™é‡ŒæŒ‚è½½æ³¨å†Œã€‚

å…¨å±€ç»„ä»¶å» main.ts æ³¨å†Œ

```vue
<!-- æ¨¡æ¿éƒ¨åˆ† -->
<template>
    <div id="app"> <!-- æ ¹ç»„ä»¶ä¸­çš„æ ¹å…ƒç´  -->
        <header>
            <h1>æˆ‘çš„ Vue åº”ç”¨</h1>
        </header>
        <main>
            <HelloWorld msg="æ¬¢è¿æ¥åˆ° Vue ä¸–ç•Œ" /> <!-- ä½¿ç”¨è‡ªå®šä¹‰çš„ HelloWorld ç»„ä»¶ -->
        </main>
    </div>
</template>

<!-- è„šæœ¬éƒ¨åˆ† -->
<script>
    import HelloWorld from './components/HelloWorld.vue' // å¯¼å…¥ HelloWorld ç»„ä»¶

    export default { // å¯¼å‡ºç»„ä»¶
        name: 'App', // ç»„ä»¶å
        components: { // æ³¨å†Œç»„ä»¶
            HelloWorld // æ³¨å†Œ HelloWorld ç»„ä»¶
        }
    }
</script>

<!-- æ ·å¼éƒ¨åˆ† -->
<style>
#app {
    font-family: 'Arial', sans-serif;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

header, footer {
    background-color: #f0f0f0;
    padding: 10px;
    margin-bottom: 20px;
}
</style>
```

### ç»„ä»¶

ä¸€ä¸ªåŠŸèƒ½ç”šè‡³ä¸€ä¸ªé¡µé¢éƒ½ç®—æ˜¯ä¸€ä¸ªç»„ä»¶ã€‚

```vue
<template>
    <div class="hello"> <!--  ç»„ä»¶çš„æ ¹å…ƒç´   -->
        <h1>{{ msg }}</h1>
        <p>{{ count }} æ¬¡ç‚¹å‡»</p>
        <button @click="incrementCount">ç‚¹å‡»</button>
    </div>
</template>

<script>
    export default { // å¯¼å‡ºç»„ä»¶
        name: 'HelloWorld', // ç»„ä»¶å
        props: { // æ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®
            msg: String // æ¥æ”¶åŒåæ•°æ®å¹¶æŒ‡å®šç±»å‹
        },
        data() { // ç»„ä»¶æ•°æ®
        return { // æ³¨å†Œæ•°æ®
            count: 0 // å®šä¹‰å¹¶åˆå§‹åŒ–ä¸€ä¸ªå€¼
        }
        },
        methods: { // ç»„ä»¶æ–¹æ³•
            incrementCount() { // å®šä¹‰å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–¹æ³•
                this.count++ // ç»„ä»¶æ•°æ®ä¸­çš„åŒåå€¼åŠ ä¸€
            }
        }
    }
</script>

<style scoped>
.hello {
    font-family: 'Arial', sans-serif;
}
</style>
```

## 2. äº”ä¸ªå¸¸ç”¨æŒ‡ä»¤

### v-bind

ç”¨äºåŠ¨æ€åœ°ç»‘å®šä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ï¼Œå°† HTML å±æ€§ä¸ Vue å®ä¾‹ä¸­çš„æ•°æ®ç»‘å®šåœ¨ä¸€èµ·ã€‚

è¿™å±äºå•å‘ç»‘å®šï¼Œæ•°æ®ä» vue æµå‘ htmlã€‚

html çš„æ”¹å˜ä¸ä¼šå½±å“ vueã€‚

```vue
<template>
    <div id="app">
        <header>
            <h1>æˆ‘çš„ Vue åº”ç”¨</h1>
        </header>
        <main>
            <HelloWorld msg="æ¬¢è¿æ¥åˆ° Vue ä¸–ç•Œ" />
            <!--  ä½¿ç”¨ v-bind ç»‘å®š class å±æ€§ï¼Œtrue åˆ™åº”ç”¨å¯¹åº”ç±»åçš„æ ·å¼ï¼Œåä¹‹ç¦ç”¨  -->
            <div v-bind:class="{ active: isActive }">è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ v-bind çš„ç¤ºä¾‹</div>
        </main>
    </div>
</template>

<script>
import HelloWorld from './components/HelloWorld.vue'

export default {
    name: 'App',
    components: {
        HelloWorld
    },
    data() {
        return {
            isActive: true
        }
    }
}
</script>

<style>
.active {
    color: red;
    font-weight: bold;
}
</style>
```

### v-for

ç”¨äºåŸºäºä¸€ä¸ªæ•°ç»„æ¸²æŸ“å¤šä¸ªå…ƒç´ ï¼Œå®ç°åˆ—è¡¨çš„å¾ªç¯ã€‚

```vue
<template>
    <div id="app">
        <header>
            <h1>æˆ‘çš„ Vue åº”ç”¨</h1>
        </header>
        <main>
            <HelloWorld msg="æ¬¢è¿æ¥åˆ° Vue ä¸–ç•Œ" />
            <ul>
                <!--  ä½¿ç”¨ v-for å¾ªç¯ç”Ÿæˆ li æ ‡ç­¾ï¼Œç”Ÿæˆæ•°é‡ç”±ä¼ å…¥æ•°ç»„é•¿åº¦å†³å®š  -->
                <!--  itemsï¼šç›®æ ‡æ•°ç»„  -->
                <!--  itemï¼šå…ƒç´   -->
                <!--  indexï¼šç´¢å¼•  -->
                <li v-for="(item, index) in items" :key="index">{{ item }}</li>
            </ul>
        </main>
    </div>
</template>

<script>
import HelloWorld from './components/HelloWorld.vue'

export default {
    name: 'App',
    components: {
        HelloWorld
    },
    data() {
        return {
            items: ['è‹¹æœ', 'é¦™è•‰', 'æ©™å­']
        }
    }
}
</script>
```

### v-if

ç”¨äºæ¡ä»¶æ¸²æŸ“å…ƒç´ ï¼Œä»…å½“è¡¨è¾¾å¼ä¸º `true` æ—¶ï¼Œå…ƒç´ æ‰ä¼šè¢«æ¸²æŸ“åˆ° DOM ä¸­ã€‚

```vue
<template>
    <div id="app">
        <header>
            <h1>æˆ‘çš„ Vue åº”ç”¨</h1>
        </header>
        <main>
            <HelloWorld msg="æ¬¢è¿æ¥åˆ° Vue ä¸–ç•Œ" />
            <div v-if="isVisible">åªæœ‰å½“ isVisible ä¸º true æ—¶æ‰æ˜¾ç¤º</div>
        </main>
    </div>
</template>

<script>
import HelloWorld from './components/HelloWorld.vue'

export default {
    name: 'App',
    components: {
        HelloWorld
    },
    data() {
        return {
            // è¿™é‡Œæ”¹æˆ true ä¸Šé¢çš„å¥å­æ‰ä¼šæ˜¾ç¤º
            isVisible: false
        }
    }
}
</script>
```

### v-model

ç”¨äºåˆ›å»ºè¡¨å•è¾“å…¥å’Œåº”ç”¨çŠ¶æ€ä¹‹é—´çš„åŒå‘æ•°æ®ç»‘å®šã€‚

è¿™å°±å±äºåŒå‘ç»‘å®šäº†ï¼Œæ•°æ®å¯ä»¥æ¥å› vue ä¸ htmlã€‚

ä¸€æ–¹å˜åŒ–å¦ä¸€æ–¹ä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚

```vue
<template>
    <div id="app">
        <header>
            <h1>æˆ‘çš„ Vue åº”ç”¨</h1>
        </header>
        <main>
            <HelloWorld msg="æ¬¢è¿æ¥åˆ° Vue ä¸–ç•Œ" />
            <!--  è¿™é‡Œå‘ç”Ÿçš„æ”¹åŠ¨éƒ½ä¼šå“åº”åœ¨ç»‘å®šçš„ message å±æ€§ä¸­  -->
            <input type="text" v-model="message" />
            <p>è¾“å…¥çš„å†…å®¹ï¼š{{ message }}</p>
        </main>
    </div>
</template>

<script>
import HelloWorld from './components/HelloWorld.vue'

export default {
    name: 'App',
    components: {
        HelloWorld
    },
    data() {
        return {
            // åŒç†ï¼Œè¿™é‡Œç›´æ¥ä¿®æ”¹å±æ€§å€¼ï¼Œä¸Šé¢çš„ input ä¸­ä¹Ÿä¼šå“åº”ç›¸åŒçš„å€¼
            message: ''
        }
    }
}
</script>
```

### v-on

ç”¨äºç›‘å¬ DOM äº‹ä»¶ï¼Œå¹¶åœ¨äº‹ä»¶è§¦å‘æ—¶æ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•æˆ–è¡¨è¾¾å¼ã€‚

```vue
<template>
    <div id="app">
        <header>
            <h1>æˆ‘çš„ Vue åº”ç”¨</h1>
        </header>
        <main>
            <HelloWorld msg="æ¬¢è¿æ¥åˆ° Vue ä¸–ç•Œ" />
            <!--  ç›‘å¬è¿™ä¸ªå…ƒç´ çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶åœ¨è§¦å‘æ—¶ç»‘å®šä¸€ä¸ªæ–¹æ³•  -->
            <button v-on:click="incrementCount">ç‚¹å‡»ï¼ˆv-onç¤ºä¾‹ï¼‰</button>
            <div>ç‚¹å‡»æ¬¡æ•°ï¼š{{ count }}</div>
        </main>
    </div>
</template>

<script>
import HelloWorld from './components/HelloWorld.vue'

export default {
    name: 'App',
    components: {
        HelloWorld
    },
    data() {
        return {
            count: 0
        }
    },
    methods: {
        incrementCount() {
            this.count++
        }
    }
}
</script>
```

## 3. Composition API åŸºç¡€

### æä¸€å˜´

è¿™ç©æ„å°±æ˜¯ vue3 ç”¨æ¥ä»£æ›¿ Options API çš„ã€‚

### setup

Composition API çš„å…¥å£ï¼Œåœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰æ‰§è¡Œã€‚

ç”¨äºåˆå§‹åŒ–ç»„ä»¶çš„å“åº”å¼æ•°æ®ã€æ–¹æ³•å’Œç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

Options API çš„ data()ï¼Œmethods å’Œå£°æ˜å‘¨æœŸé’©å­å•¥çš„å°±å…¨éƒ¨ä¸ç”¨äº†ã€‚

è¿™ä¸€ä¸ª setup æ–¹æ³•å°±å¯ä»¥å®ç°è¿™äº›ç©æ„çš„åŠŸèƒ½äº†ã€‚

```vue
<template>
    <div class="hello">
        <h1>{{ msg }}</h1>
        <p>è®¡æ•°ï¼š{{ count }}</p>
        <button @click="incrementCount">ç‚¹å‡»è®¡æ•°</button>
    </div>
</template>

<script>
import { ref, onMounted } from 'vue';

export default {
    name: 'HelloWorld',
    props: {
        msg: String
    },
    // åœ¨è¿™é‡Œå®šä¹‰å“åº”å¼æ•°æ®ã€æ–¹æ³•å’Œç”Ÿå‘½å‘¨æœŸé’©å­ç­‰
    setup(props) {
        const count = ref(0);

        const incrementCount = () => {
            count.value++;
        };
        
        onMounted(() => {
            console.log('ç»„ä»¶å·²æŒ‚è½½');
        });

        // è¿”å›éœ€è¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨çš„å˜é‡å’Œæ–¹æ³•
        return {
            count,
            incrementCount
        };
    }
}
</script>

<style scoped>
.hello {
    font-family: 'Arial', sans-serif;
}
</style>
```

### ref / reactive

Composition API ä¸­ç”¨äºåˆ›å»ºå“åº”å¼æ•°æ®çš„ä¸¤ä¸ªé‡è¦å‡½æ•°ã€‚

ref æ›´åƒå˜é‡ï¼ˆä¸å¤ªå¥½æ“ä½œçš„å˜é‡ï¼‰ã€‚

reactive æ›´åƒå¯¹è±¡ï¼ˆé’æ˜¥ç‰ˆå¯¹è±¡ï¼‰ã€‚

#### æ•°æ®æ“ä½œæ–¹å¼

- refï¼š
  - åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„å¼•ç”¨å˜é‡ï¼Œéœ€è¦é€šè¿‡ `.value` æ¥è®¿é—®å’Œä¿®æ”¹å€¼ã€‚

- reactiveï¼š
  - åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡ï¼Œç›´æ¥æ“ä½œå¯¹è±¡çš„å±æ€§ï¼Œæ— éœ€ `.value`ã€‚

#### æ€§èƒ½

reactive æ€§èƒ½æ›´é«˜ï¼Œå› ä¸ºä¸éœ€è¦é¢å¤–çš„åŒ…è£…å™¨ã€‚

#### é€‚ç”¨åœºæ™¯

- refï¼š
  - é€‚ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹æˆ–ç®€å•å¯¹è±¡ã€‚

- reactiveï¼š
  - é€‚ç”¨äºå¤æ‚å¯¹è±¡å’Œæ•°æ®ç»“æ„ã€‚

```vue
<template>
    <div class="hello">
        <h1>{{ msg }}</h1>
        <p>è®¡æ•°ï¼ˆrefï¼‰ï¼š{{ count }}</p>
        <p>è®¡æ•°ï¼ˆreactiveï¼‰ï¼š{{ state.count }}</p>
        <button @click="incrementCount">ç‚¹å‡»è®¡æ•°</button>
    </div>
</template>

<script>
import { ref, reactive } from 'vue';

export default {
    name: 'HelloWorld',
    props: {
        msg: String
    },
    setup(props) {
        const count = ref(0); // ä½¿ç”¨ ref åˆ›å»ºå“åº”å¼å˜é‡
        const state = reactive({ count: 0 }); // ä½¿ç”¨ reactive åˆ›å»ºå“åº”å¼å¯¹è±¡

        const incrementCount = () => {
            // ref éœ€è¦ç”¨é€šè¿‡ .value æ¥è®¿é—®æˆ–ä¿®æ”¹å€¼
            count.value++;
            // reactive å¯ä»¥ç›´æ¥ä»¥å¯¹è±¡çš„å½¢å¼æ“ä½œå†…éƒ¨çš„å…ƒç´ 
            state.count++;
        };

        return {
            count,
            state,
            incrementCount
        };
    }
}
</script>

<style scoped>
.hello {
    font-family: 'Arial', sans-serif;
}
</style>
```

### computed / watch

Composition API ä¸­ç”¨äºå¤„ç†å“åº”å¼æ•°æ®çš„è®¡ç®—å’Œç›‘å¬ã€‚

- computedï¼š
  - ç”¨äºå®šä¹‰è®¡ç®—å±æ€§ã€‚
  - åŸºäºå…¶ä»–å“åº”å¼æ•°æ®è¿›è¡Œè®¡ç®—ã€‚
  - è®¡ç®—å±æ€§ä¼šç¼“å­˜å…¶å€¼ï¼Œå¹¶ä¸”åªæœ‰åœ¨å®ƒçš„ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—ã€‚
- watchï¼š
  - ç”¨äºç›‘å¬å“åº”å¼æ•°æ®çš„å˜åŒ–ã€‚
  - å¹¶åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

```vue
<template>
    <div class="hello">
        <h1>{{ msg }}</h1>
        <p>è®¡æ•°ï¼š{{ count }}</p>
        <p>åŒå€è®¡æ•°ï¼ˆcomputedï¼‰ï¼š{{ doubledCount }}</p>
        <button @click="incrementCount">ç‚¹å‡»è®¡æ•°</button>
    </div>
</template>

<script>
import { ref, computed, watch } from 'vue';

export default {
    name: 'HelloWorld',
    props: {
        msg: String
    },
    setup(props) {
        const count = ref(0);
        const doubledCount = computed(() => count.value * 2); // ä½¿ç”¨ computed åˆ›å»ºè®¡ç®—å±æ€§ï¼ˆè¿™ä¸ªå±æ€§çš„å€¼ä¸ºä¾èµ–çš„å€¼*2ï¼‰

        const incrementCount = () => {
            count.value++;
        };

        watch(count, (newValue, oldValue) => { // ä½¿ç”¨ watch ä¾¦å¬ count çš„å˜åŒ–
            console.log(`è®¡æ•°ä» ${oldValue} å˜ä¸º ${newValue}`);
        });

        return {
            count,
            doubledCount,
            incrementCount
        };
    }
}
</script>

<style scoped>
.hello {
    font-family: 'Arial', sans-serif;
}
</style>
```

### ç”Ÿå‘½é’©å­

Composition API ä¸­ç”Ÿå‘½å‘¨æœŸé’©å­å…è®¸ä½ åœ¨ç»„ä»¶çš„ç‰¹å®šç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ‰§è¡Œä»£ç ã€‚

è¿™äº›é’©å­ä¸ Options API ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­ç›¸å¯¹åº”ã€‚

#### onBeforeMount

åœ¨ç»„ä»¶æŒ‚è½½åˆ° DOM ä¹‹å‰è°ƒç”¨ã€‚

#### onMounted

åœ¨ç»„ä»¶æŒ‚è½½åˆ° DOM åè°ƒç”¨ã€‚

#### onBeforeUpdate

åœ¨ç»„ä»¶æ›´æ–°ä¹‹å‰è°ƒç”¨ã€‚

#### onUpdated

åœ¨ç»„ä»¶æ›´æ–°åè°ƒç”¨ã€‚

#### onUnmounted

åœ¨ç»„ä»¶å¸è½½å‰è°ƒç”¨ã€‚

#### onBeforeUnmount

åœ¨ç»„ä»¶å¸è½½ä¹‹å‰è°ƒç”¨ã€‚

```vue
<template>
    <div class="child">
        <h1>ç”Ÿå‘½å‘¨æœŸç¤ºä¾‹</h1>
        <p>è®¡æ•°ï¼š{{ count }}</p>
        <button @click="incrementCount">ç‚¹å‡»è®¡æ•°</button>
    </div>
</template>

<script>
import { ref, onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted } from 'vue';

export default {
    name: 'Child',
    setup() {
        const count = ref(0);

        const incrementCount = () => {
            count.value++;
        };

        onBeforeMount(() => {
            console.log('onBeforeMount: ç»„ä»¶æŒ‚è½½å‰');
        });

        onMounted(() => {
            console.log('onMounted: ç»„ä»¶å·²æŒ‚è½½');
        });

        onBeforeUpdate(() => {
            console.log('onBeforeUpdate: ç»„ä»¶æ›´æ–°å‰');
        });

        onUpdated(() => {
            console.log('onUpdated: ç»„ä»¶å·²æ›´æ–°');
        });

        onBeforeUnmount(() => {
            console.log('onBeforeUnmount: ç»„ä»¶å¸è½½å‰');
        });

        onUnmounted(() => {
            console.log('onUnmounted: ç»„ä»¶å·²å¸è½½');
        });

        return {
            count,
            incrementCount
        };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### provide / inject

æä¾›ä¸æ¥æ”¶ã€‚

Composition API ä¸­ç”¨äºåœ¨ç»„ä»¶å±‚æ¬¡ç»“æ„ä¸­å…±äº«æ•°æ®ã€‚

å…è®¸çˆ¶ç»„ä»¶å‘å…¶æ‰€æœ‰å­å­™ç»„ä»¶æä¾›æ•°æ®ï¼Œè€Œä¸éœ€è¦é€šè¿‡é€å±‚ä¼ é€’ã€‚

è¿™ç©æ„ä¸»è¦å°±æ˜¯å¯ä»¥è·¨å±‚ä¼ é€’ã€‚

æ¯”å¦‚é™¤äº†ç»™å„¿å­ï¼Œç»™å­™å­ä¹Ÿå¯ä»¥ã€‚

æ³¨æ„è¿™ç©æ„åä»£ä¸èƒ½å›ä¼ ã€‚

#### çˆ¶ç»„ä»¶

åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ provide å‘å­ç»„ä»¶æä¾›æ•°æ®ã€‚

```vue
<template>
    <div id="app">
        <header>
            <h1>æˆ‘çš„ Vue åº”ç”¨</h1>
        </header>
        <main>
            <p>æ¶ˆæ¯ï¼š{{ message }}</p>
            <button @click="updateMessage">æ›´æ–°æ¶ˆæ¯</button>
            <Child />
        </main>
    </div>
</template>

<script>
import { ref, provide } from 'vue';
import Child from './components/Child.vue'

export default {
    name: 'App',
    components: {
        Child
    },
    setup() {
        const message = ref('åˆå§‹æ¶ˆæ¯');

        provide('message', message); // æä¾›æ•°æ®

        const updateMessage = () => {
            message.value = 'æ›´æ–°åçš„æ¶ˆæ¯';
        };

        return {
            message,
            updateMessage
        };
    }
}
</script>
```

#### å­ç»„ä»¶

åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨ inject æ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®ã€‚

```vue
<template>
    <div class="child">
        <h2>å­ç»„ä»¶</h2>
        <p>æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š{{ injectedMessage }}</p>
    </div>
</template>

<script>
import { inject } from 'vue';

export default {
    name: 'Child',
    setup() {
        const injectedMessage = inject('message'); // æ¥æ”¶æ•°æ®

        return {
            injectedMessage
        };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

## 4. ç»„ä»¶åŒ–å¼€å‘

### åˆ›å»ºå’Œæ³¨å†Œç»„ä»¶

vue å°±æ˜¯ç»„ä»¶åŒ–å¼€å‘å˜›ï¼Œå•¥ç©æ„éƒ½å¯ä»¥æ‰“æˆç»„ä»¶ã€‚

è¿™ä¸ªåœ¨ vue ä¸­æœ€åŸºæœ¬çš„å•ä½çš„åˆ›å»ºéœ€è¦ä¸‰ä¸ªå¿…éœ€å…ƒç´ ã€‚

#### åˆ›å»º

ä¸‹é¢ä¸‰ä¸ªæ‹¼åœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ªç»„ä»¶ã€‚

##### æ¨¡æ¿

å°±æ˜¯æ”¾æ ‡ç­¾ï¼Œç»“æ„ï¼Œå…¶å®ƒç»„ä»¶å•¥çš„ã€‚

```vue
<template>
	<!--  æ ¹å…ƒç´ ï¼Œå¿…é¡»æœ‰çš„  -->
    <div class="child">
        <!--  æ”¾åœ¨è¿™é‡Œ  -->
    </div>
</template>
```

##### è„šæœ¬

å°±æ˜¯ js å˜›ã€‚

ä¹ŸåŒ…æ‹¬ vue çš„å„ç§å¼•å…¥ï¼Œæ³¨å†Œï¼Œæ“ä½œç­‰å„ç§ç©æ„éƒ½åœ¨è¿™é‡Œã€‚

```vue
<script>
import { inject } from 'vue';

export default {
    name: 'Child',
    setup() {
        const num = 1;

        return {
            num
        };
    }
}
</script>
```

##### æ ·å¼

å°±æ˜¯ css æ ·å¼ã€‚

```vue
<!--  æ ·å¼  -->
<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

#### æ³¨å†Œ

ç»„ä»¶è‹¥æƒ³åœ¨å…¶å®ƒç»„ä»¶ä¸­åº”ç”¨ï¼Œé‚£å°±è¦åœ¨ç›¸åº”çš„ç»„ä»¶ä¸­æ³¨å†Œã€‚

æ³¨å†Œä¹‹åçš„ç»„ä»¶ä»…éœ€è¦ç›´æ¥ä½¿ç”¨æ³¨å†Œåï¼Œä»¥æ ‡ç­¾çš„å½¢å¼å†™è¿›å»å°±è¡Œã€‚

```vue
<template>
    <div id="app">
        <Child />
    </div>
</template>

<script>
import Child from './components/Child.vue'
    
export default {
    name: 'App',
    components: {
        Child
    },
    setup() {}
}
</script>

<style scoped></style>
```

### props / emit

çˆ¶å­ç»„ä»¶é€šä¿¡ï¼ˆä¼ é€’ / æ¥æ”¶ï¼‰ã€‚

ä»…ç”¨äºç›´ç³»äº²å±ä¸”ä»…ä¸€ä»£å…³ç³»ï¼šï¼‰

å°±ç»™ä¸ªå„¿å­å°±æ²¡äº†ã€‚

ç»™å­™å­æˆ–æ›´åé¢çš„ç”¨ä¸Šé¢çš„ provide / injectã€‚

è¿™ç©æ„çš„åä»£å¯ä»¥å›ä¼ ã€‚

#### çˆ¶ç»„ä»¶

```vue
<template>
    <div class="app">
        <h1>çˆ¶ç»„ä»¶</h1>
        <p>æ¶ˆæ¯ï¼š{{ message }}</p>
        <button @click="updateMessage">æ›´æ–°æ¶ˆæ¯</button>
        <!--  ä¼ é€’çš„æ•°æ®ï¼ˆæŒ‡å®šæ•°æ®åä¸å€¼ï¼‰ï¼Œæ¥æ”¶æ•°æ®æ—¶çš„æ“ä½œï¼ˆæŒ‡å®šæ•°æ®åä¸æ“ä½œï¼‰  -->
        <Child :greeting="greeting" @update-count="handleUpdateCount" />
    </div>
</template>

<script>
import { ref } from 'vue';
import Child from './components/Child.vue';

export default {
    name: 'App',
    components: {
        Child
    },
    setup() {
        const message = ref('çˆ¶ç»„ä»¶çš„æ¶ˆæ¯');
        const greeting = ref('å­ç»„ä»¶çš„æ¶ˆæ¯');

        // ç”¨äºæ›´æ–°å‘å­ç»„ä»¶å‘é€çš„æ•°æ®
        const updateMessage = () => {
            greeting.value = message.value;
        };

        // ç”¨äºæ¥æ”¶å­ç»„ä»¶çš„å›ä¼ æ•°æ®
        const handleUpdateCount = (count) => {
            console.log(`å­ç»„ä»¶çš„è®¡æ•°æ›´æ–°ä¸ºï¼š${count}`);
        };

        return {
            message,
            greeting,
            updateMessage,
            handleUpdateCount
        };
    }
}
</script>

<style scoped>
.app {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

#### å­ç»„ä»¶

```vue
<template>
    <div class="child">
        <h2>å­ç»„ä»¶</h2>
        <p>{{ greeting }}</p>
        <p>è®¡æ•°ï¼š{{ count }}</p>
        <button @click="incrementCount">å¢åŠ è®¡æ•°</button>
    </div>
</template>

<script>
import { ref } from 'vue';

export default {
    name: 'Child',
    // æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„æ•°æ®
    props: {
        greeting: String
    },
    setup(props, { emit }) {
        const count = ref(0);

        // å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®
        const incrementCount = () => {
          count.value++;
            // é€šè¿‡ emit å‘çˆ¶ç»„ä»¶å‘é€äº‹ä»¶å’Œæ•°æ®
            // å®šä¹‰æ•°æ®åä¸æ•°æ®
          emit('update-count', count.value);
        };

        return {
          count,
          incrementCount
        };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### slot

è¿™ç©æ„è¯´æ˜¯ Vue ä¸­ç”¨äºå†…å®¹åˆ†å‘çš„æœºåˆ¶ï¼Œå…è®¸çˆ¶ç»„ä»¶åœ¨å­ç»„ä»¶çš„æ¨¡æ¿ä¸­æ’å…¥è‡ªå®šä¹‰å†…å®¹ã€‚

è¿™ä¸ªæ¨¡æ¿å¥½åƒä¹Ÿå«æ’æ§½ã€‚

ä¼¼ä¹æœ‰ä¸‰ç§ã€‚

#### é»˜è®¤æ’æ§½

æ²¡æœ‰æŒ‡å®šåç§°çš„æ’æ§½ã€‚

ç›´æ¥æŠŠå®šä¹‰å¥½çš„å…ƒç´ æ•´ä¸ªæ¬è¿‡å»ç”¨ã€‚

##### çˆ¶ç»„ä»¶

```vue
<template>
    <div class="app">
        <h1>çˆ¶ç»„ä»¶</h1>
        <Child>
            <p>è¿™æ˜¯çˆ¶ç»„ä»¶é€šè¿‡é»˜è®¤æ’æ§½ä¼ é€’çš„å†…å®¹ã€‚</p>
        </Child>
    </div>
</template>

<script>
import Child from './components/Child.vue';

export default {
    name: 'App',
    components: {
        Child
    },
    setup() {}
}
</script>

<style scoped>
.app {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

##### å­ç»„ä»¶

```vue
<template>
    <div class="child">
        <h2>å­ç»„ä»¶</h2>
        <slot>é»˜è®¤å†…å®¹</slot>
    </div>
</template>

<script>
export default {
    name: 'Child',
    setup() {}
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

#### å…·åæ’æ§½

é€šè¿‡ `name` å±æ€§æŒ‡å®šåç§°çš„æ’æ§½ã€‚

åœ¨çˆ¶ç»„ä»¶ä¸­ç”¨ template å®šä¹‰åˆ†å—çš„ç»“æ„ï¼Œéœ€è¦ä½¿ç”¨ v-slot å®šä¹‰è¯†åˆ«åã€‚

å­ç»„ä»¶ä¸­ä½¿ç”¨ name å±æ€§å¯¹åº”ç»‘å®šçˆ¶ç»„ä»¶å®šä¹‰å¥½çš„ç»“æ„çš„è¯†åˆ«åã€‚

##### çˆ¶ç»„ä»¶

```vue
<template>
    <div class="app">
        <h1>çˆ¶ç»„ä»¶</h1>
        <Child>
            <template v-slot:header>
                <h3>è‡ªå®šä¹‰æ ‡é¢˜</h3>
            </template>
            <template v-slot:content>
                <p>è¿™æ˜¯çˆ¶ç»„ä»¶é€šè¿‡å…·åæ’æ§½ä¼ é€’çš„å†…å®¹ã€‚</p>
            </template>
            <template v-slot:footer>
                <button @click="handleClick">ç‚¹å‡»æŒ‰é’®</button>
            </template>
        </Child>
    </div>
</template>

<script>
import Child from './components/Child.vue';

export default {
    name: 'App',
    components: {
        Child
    },
    setup() {
        const handleClick = () => {
            console.log('æŒ‰é’®è¢«ç‚¹å‡»äº†');
        };

        return {
            handleClick
        };
    }
}
</script>

<style scoped>
.app {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

##### å­ç»„ä»¶

```vue
<template>
    <div class="child">
        <h2>å­ç»„ä»¶</h2>
        <div class="header">
            <slot name="header">é»˜è®¤æ ‡é¢˜</slot>
        </div>
        <div class="content">
            <slot name="content">é»˜è®¤å†…å®¹</slot>
        </div>
        <div class="footer">
            <slot name="footer">é»˜è®¤é¡µè„š</slot>
        </div>
    </div>
</template>

<script>
export default {
    name: 'Child',
    setup() {}
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

#### ä½œç”¨åŸŸæ’æ§½

å¸¦æ•°æ®çš„æ’æ§½ï¼Œå…è®¸çˆ¶ç»„ä»¶è®¿é—®å­ç»„ä»¶ä¸­çš„æ•°æ®ã€‚

ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒslotProps ç›´æ¥ç­‰äº slotData äº†ã€‚

slotData è¿™ä¸ªå­ç»„ä»¶çš„å¯¹è±¡è¢«æ•´ä¸ªæ˜ å°„åˆ°çˆ¶ç»„ä»¶çš„ slotProps  å€¼ä¸­äº†ã€‚

##### çˆ¶ç»„ä»¶

```vue
<template>
    <div class="app">
        <h1>çˆ¶ç»„ä»¶</h1>
        <Child>
            <!--  å®šä¹‰é»˜è®¤ä¼ é€’çš„å¯¹è±¡å  -->
            <template v-slot:default="slotProps">
                <!--  è·å–å¯¹è±¡çš„å€¼  -->
                <p>è¿™æ˜¯çˆ¶ç»„ä»¶é€šè¿‡ä½œç”¨åŸŸæ’æ§½ä¼ é€’çš„å†…å®¹ï¼Œå­ç»„ä»¶çš„æ•°æ®ï¼š{{ slotProps.data }}</p>
            </template>
        </Child>
    </div>
</template>

<script>
import Child from './components/Child.vue';

export default {
    name: 'App',
    components: {
        Child
    },
    setup() {}
}
</script>

<style scoped>
.app {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

##### å­ç»„ä»¶

```vue
<template>
    <div class="child">
        <h2>å­ç»„ä»¶</h2>
        <!--  ç»‘å®šè‡³çˆ¶ç»„ä»¶çš„æ’æ§½çš„é»˜è®¤å¯¹è±¡  -->
        <slot :data="slotData">é»˜è®¤å†…å®¹</slot>
    </div>
</template>

<script>
export default {
    name: 'Child',
    setup() {
        const slotData = {
            data: 'å­ç»„ä»¶çš„æ•°æ®'
        };

        return {
            slotData
        };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### åŠ¨æ€åŠ è½½å’Œå¼‚æ­¥åŠ è½½

è¿™ä¿©ç©æ„æ˜¯ Vue ä¸­ç”¨äºä¼˜åŒ–ç»„ä»¶åŠ è½½å’Œç®¡ç†çš„ä¸¤ç§ä¸åŒæœºåˆ¶ã€‚

#### åŠ¨æ€ç»„ä»¶

å…è®¸ä½ åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´åŠ¨æ€åˆ‡æ¢ï¼ŒVue ä¼šæ ¹æ®ç»‘å®šçš„å€¼æ¥å†³å®šæ˜¾ç¤ºå“ªä¸ªç»„ä»¶ã€‚

è¿™é€šå¸¸ç”¨äºéœ€è¦åœ¨åŒä¸€ä½ç½®æ˜¾ç¤ºä¸åŒç»„ä»¶çš„åœºæ™¯ã€‚

å½“éœ€è¦æ ¹æ®æ¡ä»¶æˆ–ç”¨æˆ·äº¤äº’æ¥åˆ‡æ¢ä¸åŒçš„ç»„ä»¶æ—¶å¯ä»¥ç”¨è¿™ä¸ªã€‚

```vue
<template>
    <div class="app">
        <h1>çˆ¶ç»„ä»¶</h1>
        <button @click="change('Child')">æ˜¾ç¤ºç»„ä»¶ A</button>
        <button @click="change('B')">æ˜¾ç¤ºç»„ä»¶ B</button>
        <button @click="change('C')">æ˜¾ç¤ºç»„ä»¶ C</button>
        <component :is="currentComponent" />
    </div>
</template>

<script>
import {ref} from 'vue';

import Child from './components/Child.vue';
import B from './components/B.vue';
import C from './components/C.vue';

export default {
    name: 'App',
    components: {
        Child,
        B,
        C
    },
    setup() {
        const currentComponent = ref('Child');
        const change = (target) => {
            currentComponent.value = target;
        }

        return {
            change,
            currentComponent
        };
    }
}
</script>

<style scoped>
.app {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

#### å¼‚æ­¥ç»„ä»¶

å…è®¸ä½ å®šä¹‰ä¸€ä¸ªå¼‚æ­¥åŠ è½½çš„ç»„ä»¶ï¼ŒVue ä¼šåœ¨éœ€è¦æ¸²æŸ“è¯¥ç»„ä»¶æ—¶æ‰åŠ è½½å®ƒã€‚

è¿™å¯ä»¥ç”¨äºä¼˜åŒ–åº”ç”¨çš„åˆå§‹åŠ è½½æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å½“ç»„ä»¶å¾ˆå¤§æˆ–ä¸å¸¸ä½¿ç”¨æ—¶ã€‚

å½“éœ€è¦å»¶è¿ŸåŠ è½½ç»„ä»¶ä»¥æé«˜åˆå§‹é¡µé¢åŠ è½½æ€§èƒ½æ—¶å¯ä»¥ç”¨è¿™ä¸ªã€‚

```vue
<template>
    <div class="app">
        <h1>çˆ¶ç»„ä»¶</h1>
        <button @click="showAsyncComponent = true">åŠ è½½å¼‚æ­¥ç»„ä»¶</button>
        <Child v-if="showAsyncComponent" />
    </div>
</template>

<script>
import { ref, defineAsyncComponent } from 'vue';

import Child from './components/Child.vue';

export default {
    name: 'App',
    components: {
        Child
    },
    setup() {
        const showAsyncComponent = ref(false);

        const AsyncComponent = defineAsyncComponent(() => import(Child));

        return {
            showAsyncComponent,
            AsyncComponent
        };
    }
}
</script>

<style scoped>
.app {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

# 3ï¼Œè¿›é˜¶

## 1. è·¯ç”±ç®¡ç†

### å®‰è£…å’Œé…ç½®è·¯ç”±

è·¯ç”±æ˜¯ Web åº”ç”¨ä¸­ç®¡ç†é¡µé¢å¯¼èˆªå’Œå†…å®¹å±•ç¤ºçš„ä¸€ç§æœºåˆ¶ã€‚

åœ¨ Vue ä¸­ï¼Œè·¯ç”±ç”¨äºå®ç°å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰ä¸­çš„é¡µé¢åˆ‡æ¢å’Œå†…å®¹æ›´æ–°ã€‚

åæ­£ä¸»è¦å°±æ˜¯å„ç§è·³è½¬è¿™ä¸ªè·³è½¬å“ªä¸ªçš„ã€‚

#### å®‰è£…

å»å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤ã€‚

```powershell
npm install --save-dev @types/vue-router
```

#### é…ç½® main.ts

ç„¶åé…ç½® mainã€‚

åŠ ä¸¤å¥è¯å°±å¥½ã€‚

```typescript
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'; // å¯¼å…¥è·¯ç”±

const app = createApp(App)
app.use(router); // æŒ‚è½½è·¯ç”±
app.mount('#app')
```

#### é…ç½®è·¯ç”±

åœ¨ src ä¸‹åˆ›å»º router æ–‡ä»¶å¤¹ã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢å†åˆ›å»ºä¸€ä¸ª index.jsã€‚

```javascript
// å¯¼å…¥è·¯ç”±
import { createRouter, createWebHistory } from 'vue-router';
// å¯¼å…¥éœ€è¦è·³è½¬çš„ç»„ä»¶
import Child from '../components/Child.vue';
import B from '../components/B.vue';
import C from '../components/C.vue';

// è·¯ç”±åˆ—è¡¨
const routes = [
    // åœ°å€ï¼Œç›®æ ‡åï¼Œæ˜ å°„çš„ç»„ä»¶å
    { path: '/', name: 'child', component: Child },
    { path: '/b', name: 'b', component: B },
    { path: '/c', name: 'c', component: C }
];

// åº”ç”¨è·¯ç”±
const router = createRouter({
    history: createWebHistory(),
    routes
});

// å¯¼å‡º
export default router;
```

#### ä½¿ç”¨

```vue
<template>
    <div class="app">
        <h1>çˆ¶ç»„ä»¶</h1>
        <!--  å‡è£…è¿™æ˜¯ä¸€ä¸ªå¯¼èˆªæ   -->
        <nav>
            <!--  é“¾æ¥çš„è·¯ç”±åœ°å€  -->
            <router-link to="/">Child</router-link> |
            <router-link to="/b">B</router-link> |
            <router-link to="/c">C</router-link>
        </nav>
        <!--  å°†åœ°å€æŒ‡å‘çš„ç»„ä»¶æ¸²æŸ“åœ¨è¿™é‡Œ  -->
        <router-view />
    </div>
</template>

<script>
export default {
    name: 'App',
    components: {},
    setup() {}
}
</script>

<style scoped>
.app {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### åŠ¨æ€è·¯ç”±å’ŒåµŒå¥—è·¯ç”±

#### åŠ¨æ€è·¯ç”±

åŠ¨æ€è·¯ç”±å…è®¸ä½ åœ¨ URL ä¸­æ•è·å‚æ•°ï¼Œè¿™äº›å‚æ•°å¯ä»¥ä¼ é€’ç»™ç»„ä»¶ä»¥æ˜¾ç¤ºåŠ¨æ€å†…å®¹ã€‚

å°±æ˜¯å¯ä»¥ç”¨ URL ä¼ é€’å‚æ•°ã€‚

##### è·¯ç”±é…ç½®

```javascript
import { createRouter, createWebHistory } from 'vue-router';
import Child from '../components/Child.vue';
import B from '../components/B.vue';
import C from '../components/C.vue';

const routes = [
    { path: '/', name: 'child', component: Child },
    // åœ¨åœ°å€åé¢åŠ ä¸Šå‚æ•°å
    { path: '/b/:id', name: 'b', component: B },
    { path: '/c', name: 'c', component: C }
];

const router = createRouter({
    history: createWebHistory(),
    routes
});

export default router;
```

##### æ•è·å€¼

`http://localhost:5173/b/1`ï¼Œè¿™æ ·è®¿é—®å°±å¯ä»¥äº†ã€‚

ä¸Šé¢è·¯ç”±é…ç½®çš„åœ°å€å‚æ•°ä¸­ï¼Œ`/b/:id` ä¸­çš„ id å°±æ˜¯1ã€‚

```vue
<template>
    <div class="b">
        <h2>B</h2>
        <p>ç”¨æˆ· ID: {{ id }}</p>
    </div>
</template>

<script>
import { ref, onMounted } from 'vue';
import { useRoute } from 'vue-router';

export default {
    name: 'B',
    setup() {
        // å£°æ˜ä¸€ä¸ªç©ºå€¼å’Œä¸€ä¸ªè·¯ç”±å¯¹è±¡
        const id = ref('');
        const route = useRoute();
        
        // ç»„ä»¶æŒ‚è½½åï¼Œè·å–è·¯ç”±å¯¹è±¡çš„åœ°å€çš„idå‚æ•°çš„å€¼
        onMounted(() => {
            id.value = route.params.id;
        });

        return {
            id
        };
    }
}
</script>

<style scoped>
.b {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

#### åµŒå¥—è·¯ç”±

åµŒå¥—è·¯ç”±å…è®¸ä½ å®šä¹‰çˆ¶è·¯ç”±å’Œå­è·¯ç”±ä¹‹é—´çš„å…³ç³»ï¼Œå­è·¯ç”±çš„è§†å›¾ä¼šæ¸²æŸ“åœ¨çˆ¶è·¯ç”±çš„ `<router-view>` ä¸­ã€‚

å…¶å®å°±æ˜¯åœ¨åŠ¨æ€è·¯ç”±é‡Œé¢åˆåŠ äº†ä¸€ä¸ªåŠ¨æ€è·¯ç”±ã€‚

##### è·¯ç”±é…ç½®

```javascript
import { createRouter, createWebHistory } from 'vue-router';
import Child from '../components/Child.vue';
import B from '../components/B.vue';
import C from '../components/C.vue';

const routes = [
    // åœ¨å¸¸è§„é…ç½®åé¢åŠ ä¸Šchildrenå‚æ•°
    // é‡Œé¢è¿˜æ˜¯æŒ‰ç…§å¸¸è§„é…ç½®çš„æ–¹æ³•ç»™ä¸Šå­è·¯ç”±
    { path: '/', name: 'child', component: Child,
        children: [
            { path: 'b', component: B },
            { path: 'c', component: C }
        ]},
    { path: '/b', name: 'b', component: B },
    { path: '/c', name: 'c', component: C }
];

const router = createRouter({
    history: createWebHistory(),
    routes
});

export default router;
```

##### è·³è½¬

```vue
<template>
    <div class="child">
        <h2>Child</h2>
        <!--  ç‚¹å‡»åˆ‡æ¢ä¸åŒçš„å­ç»„ä»¶  -->
        <nav>
            <router-link to="/b">ä¸ªäººèµ„æ–™</router-link> |
            <router-link to="/c">æˆ‘çš„è®¢å•</router-link>
        </nav>
        <router-view />
    </div>
</template>

<script>
export default {
    name: 'Child',
    setup() {}
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### è·¯ç”±å®ˆå«

è·¯ç”±å®ˆå«æ˜¯è·¯ç”±æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºåœ¨è·¯ç”±å¯¼èˆªæ—¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚

ä¸€èˆ¬å°±æœ‰ä¸‰ç§å®ˆå«ã€‚

#### å…¨å±€å®ˆå«

å…¨å±€å®ˆå«åœ¨æ¯æ¬¡è·¯ç”±å¯¼èˆªæ—¶éƒ½ä¼šæ‰§è¡Œã€‚

å¯ä»¥ç”¨äºå…¨å±€çš„æƒé™éªŒè¯ã€é¡µé¢åŠ è½½é€»è¾‘ç­‰ã€‚

ä¸‹é¢ä¸¾ä¾‹ä¸‰ç§å…¨å±€å®ˆå«ã€‚

```javascript
import { createRouter, createWebHistory } from 'vue-router';
import Child from '../components/Child.vue';
import B from '../components/B.vue';
import C from '../components/C.vue';

const routes = [
    { path: '/', name: 'child', component: Child },
    { path: '/b', name: 'b', component: B },
    { path: '/c', name: 'c', component: C }
];

const router = createRouter({
    history: createWebHistory(),
    routes
});

// å…¨å±€å‰ç½®å®ˆå«
// è·¯ç”±è§£æå’Œç»„ä»¶å®ä¾‹åŒ–ä¹‹å‰
router.beforeEach((to, from, next) => {
    console.log('å…¨å±€å‰ç½®å®ˆå«', to, from);
    next();
});

// å…¨å±€è§£æå®ˆå«
// è·¯ç”±å·²ç»ç¡®å®šï¼Œç»„ä»¶å®ä¾‹ä¹Ÿå·²ç»åˆ›å»ºï¼Œä½†é¡µé¢è¿˜æ²¡æœ‰æ›´æ–°
router.beforeResolve((to, from, next) => {
    console.log('å…¨å±€è§£æå®ˆå«', to, from);
    next();
});

// å…¨å±€åç½®å®ˆå«
// ç»„ä»¶å®ä¾‹å·²ç»æŒ‚è½½åˆ° DOM ä¸Šï¼Œå¯¼èˆªå·²ç»ç¡®è®¤å®Œæˆ
router.afterEach((to, from) => {
    console.log('å…¨å±€åç½®å®ˆå«', to, from);
});

export default router;
```

#### ç‹¬äº«å®ˆå«

è·¯ç”±ç‹¬äº«å®ˆå«æ˜¯æŸä¸ªè·¯ç”±ç‹¬æœ‰çš„å®ˆå«ï¼Œé€‚ç”¨äºç‰¹å®šè·¯ç”±çš„éªŒè¯æˆ–åŠ è½½é€»è¾‘ã€‚

ä»…åœ¨ç‰¹å®šè·¯ç”±è¢«è§¦å‘æ—¶è¢«è°ƒç”¨ã€‚

```javascript
import { createRouter, createWebHistory } from 'vue-router';
import Child from '../components/Child.vue';
import B from '../components/B.vue';
import C from '../components/C.vue';

const routes = [
    { path: '/', name: 'child', component: Child,
     // ä»…ä½œç”¨äºè¿™ä¸€ä¸ªè·¯ç”±
        beforeEnter: (to, from, next) => {
            console.log('è·¯ç”±ç‹¬äº«å®ˆå«', to, from);
            next();
        }
    },
    { path: '/b', name: 'b', component: B },
    { path: '/c', name: 'c', component: C }
];

const router = createRouter({
    history: createWebHistory(),
    routes
});

export default router;
```

#### ç»„ä»¶å®ˆå«

ç»„ä»¶å†…å®ˆå«å®šä¹‰åœ¨ç»„ä»¶å†…éƒ¨ï¼Œç”¨äºåœ¨ç»„ä»¶çº§åˆ«æ§åˆ¶å¯¼èˆªé€»è¾‘ã€‚

ä¹Ÿæ˜¯åœ¨è¿™ä¸ªç»„ä»¶çš„è·¯ç”±è¢«è§¦å‘æ—¶è°ƒç”¨ã€‚

ç›¸æ¯”ç‹¬äº«å®ˆå«ï¼Œç»„ä»¶å®ˆå«å°±æ˜¯å¤šäº†ä¸€ä¸ªå¯ä»¥è®¿é—®ç»„ä»¶å†…å…ƒç´ çš„èƒ½åŠ›ã€‚

è¿™é‡Œä¹Ÿæ˜¯ä»…ä¸¾ä¾‹ä¸‰ä¸ªå¸¸ç”¨çš„ç»„ä»¶å®ˆå«çš„æ–¹æ³•ã€‚

```vue
<template>
    <div class="child">
        <h2>Child</h2>
    </div>
</template>

<script>
import {onMounted} from "vue";
import {onBeforeRouteLeave, onBeforeRouteUpdate} from "vue-router";

export default {
    name: 'Child',
    setup() {
        onMounted(() => {
            console.log('ç»„ä»¶å·²æŒ‚è½½');
        });

        onBeforeRouteUpdate((to, from, next) => {
            console.log('ç»„ä»¶å†…æ›´æ–°å®ˆå«', to, from);
            next();
        });

        onBeforeRouteLeave((to, from, next) => {
            console.log('ç»„ä»¶å†…ç¦»å¼€å®ˆå«', to, from);
            next();
        });

        return {};
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

## 2. çŠ¶æ€ç®¡ç†

### å®‰è£…å’Œé…ç½® Pinia

Pinia æ˜¯ Vue.js çš„ä¸€ä¸ªçŠ¶æ€ç®¡ç†åº“ï¼Œç”¨äºå¸®åŠ©å¼€å‘è€…ç®¡ç†åº”ç”¨ä¸­çš„å…¨å±€çŠ¶æ€ã€‚

å®ƒæ˜¯ Vuex çš„æ›¿ä»£å“ï¼Œä¸“é—¨ç”¨äº Vue 3ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒ Vue 2ã€‚

Pinia æä¾›äº†æ›´ç®€æ´å’Œçµæ´»çš„ APIï¼Œä½¿å¾—çŠ¶æ€ç®¡ç†æ›´åŠ ç›´è§‚å’Œæ˜“äºä½¿ç”¨ã€‚

#### å®‰è£…

å‘½ä»¤è¡Œã€‚

```powershell
npm install pinia
```

#### é…ç½® main.ts

```typescript
import { createApp } from 'vue' // å¯¼å…¥ createApp å‡½æ•°
import App from './App.vue' // å¯¼å…¥æ ¹ç»„ä»¶
import router from './router'; // å¯¼å…¥è·¯ç”±
import { createPinia } from 'pinia'; // å¯¼å…¥ğŸ

const app = createApp(App) // ä½¿ç”¨ createApp å‡½æ•°åˆ›å»ºåº”ç”¨å®ä¾‹
const pinia = createPinia();

app.use(router);
app.use(pinia);

app.mount('#app') // æŒ‚è½½åº”ç”¨å®ä¾‹åˆ° DOM ä¸­çš„ app å…ƒç´ 
```

#### é…ç½®ğŸæ§åˆ¶å™¨

è¿™ä¸ªä»…ä¸ºä¸€ä¸ªç¤ºä¾‹ï¼Œä¸æ˜¯å›ºå®šçš„å†™æ³•ã€‚

```javascript
import { defineStore } from 'pinia';

export const useCounterStore = defineStore('counter', {
    state: () => ({
        count: 0
    }),
    getters: {
        doubleCount: (state) => state.count * 2
    },
    actions: {
        increment() {
            this.count++;
        }
    }
});
```

#### ä½¿ç”¨

```vue
<template>
    <div class="child">
        <h2>Child</h2>
        <!--  ä½¿ç”¨å¯¹è±¡ä¸­çš„å€¼æˆ–æ–¹æ³•  -->
        <p>è®¡æ•°ï¼š{{ counterStore.count }}</p>
        <p>åŒå€è®¡æ•°ï¼š{{ counterStore.doubleCount }}</p>
        <button @click="counterStore.increment">ç‚¹å‡»è®¡æ•°</button>
    </div>
</template>

<script>
// å¯¼å…¥ğŸæ§åˆ¶å™¨
import { useCounterStore } from '../stores/counter';

export default {
    name: 'Child',
    setup() {
        // å–å‡ºä¸€ä¸ªæ§åˆ¶å¯¹è±¡
        const counterStore = useCounterStore();

        return { counterStore };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### Stroe ç»„æˆ

ä¸€èˆ¬æœ‰ä¸‰ä¸ªéƒ¨åˆ†ã€‚

#### çŠ¶æ€ï¼ˆStateï¼‰

**ä½œç”¨**ï¼šå­˜å‚¨åº”ç”¨çš„çŠ¶æ€æ•°æ®ã€‚

**å†…å®¹**ï¼šä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°ï¼Œè¯¥å¯¹è±¡åŒ…å«åº”ç”¨ä¸­éœ€è¦ç®¡ç†çš„çŠ¶æ€å±æ€§ã€‚

#### è®¡ç®—å±æ€§ï¼ˆGettersï¼‰

**ä½œç”¨**ï¼šåŸºäº store çš„çŠ¶æ€æ´¾ç”Ÿå‡ºæ–°çš„çŠ¶æ€ï¼Œç±»ä¼¼äº Vue ä¸­çš„è®¡ç®—å±æ€§ã€‚

**å†…å®¹**ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å¤šä¸ªå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°æ¥æ”¶ `state` ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›è®¡ç®—åçš„å€¼ã€‚

#### åŠ¨ä½œï¼ˆActionsï¼‰

**ä½œç”¨**ï¼šå®šä¹‰ä¿®æ”¹ store çŠ¶æ€çš„æ–¹æ³•ã€‚

**å†…å®¹**ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å¤šä¸ªå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°å¯ä»¥ä¿®æ”¹ `state` çš„å€¼ï¼Œå¹¶å¯ä»¥åŒ…å«å¼‚æ­¥æ“ä½œã€‚

### Store åŸºç¡€ç”¨æ³•

åœ¨ Pinia ä¸­ï¼Œ`store` æ˜¯ä¸€ä¸ªé›†ä¸­ç®¡ç†åº”ç”¨çŠ¶æ€çš„å®¹å™¨ã€‚

å®ƒåŒ…å«åº”ç”¨ä¸­çš„å…±äº«çŠ¶æ€ï¼ˆ`state`ï¼‰ã€åŸºäºçŠ¶æ€çš„è®¡ç®—å±æ€§ï¼ˆ`getters`ï¼‰ã€ä»¥åŠä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ï¼ˆ`actions`ï¼‰ã€‚

é€šè¿‡ `store`ï¼Œä½ å¯ä»¥åœ¨ Vue ç»„ä»¶ä¸­è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹è¿™äº›çŠ¶æ€ï¼Œå®ç°è·¨ç»„ä»¶çš„çŠ¶æ€å…±äº«å’Œç®¡ç†ã€‚

`store` å°±æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†ä»“åº“ï¼Œç»„ä»¶éœ€è¦çš„çŠ¶æ€å’Œæ“ä½œéƒ½å¯ä»¥ä»è¿™é‡Œè·å–ã€‚

#### åˆ›å»º Store

å°±å…ˆç”¨ä¸Šé¢çš„ä¾‹å­è®²ã€‚

```javascript
import { defineStore } from 'pinia';

export const useCounterStore = defineStore('counter', {
    state: () => ({
        count: 0
    }),
    getters: {
        doubleCount: (state) => state.count * 2
    },
    actions: {
        increment() {
            this.count++;
        }
    }
});

// export const æ–°åå­— = defineStore('æ–°åå­—', {...})
```

#### ä½¿ç”¨ Stroe

```vue
<template>
    <div class="child">
        <h2>Child</h2>
        <p>è®¡æ•°ï¼š{{ counterStore.count }}</p>
        <p>åŒå€è®¡æ•°ï¼š{{ counterStore.doubleCount }}</p>
        <button @click="counterStore.increment">ç‚¹å‡»è®¡æ•°</button>
    </div>
</template>

<script>
import { useCounterStore } from '../stores/counter';

export default {
    name: 'Child',
    setup() {
        const counterStore = useCounterStore();

        return { counterStore };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### æ¨¡å—åŒ–ç®¡ç†

ä¸»è¦æ‰‹æ®µå°±æ˜¯æ‹†åˆ†ã€‚

é€šè¿‡æ‹†åˆ† stateã€gettersã€actions ç­‰ç»“æ„è‡³ä¸åŒæ–‡ä»¶ä»¥è¿›è¡Œæ¨¡å—åŒ–ç®¡ç†ã€‚

#### ç»“æ„

stateã€gettersã€actions æ˜¯ä¸€ç»„å˜›ã€‚

å½“ç„¶å¦‚æœ store å¾ˆå¤šï¼Œstateã€gettersã€actions ä¹Ÿæœ‰å¾ˆå¤šç»„ã€‚

é‚£åœ¨ modules æ–‡ä»¶å¤¹ä¸‹ä¹Ÿå¯ä»¥ç»§ç»­ä»¥åŠŸèƒ½æˆ–ç»„ä»¶ç­‰è§„å®šç»§ç»­ä¸‹åˆ†æ–‡ä»¶å¤¹ã€‚

é‡Œé¢å†æ”¾å¯¹åº”çš„ stateã€gettersã€actions ç»„ã€‚

è¿™é‡Œä»…ç”¨ä¸€ä¸ª stateã€gettersã€actions  ç»„ä¸¾ä¾‹ï¼Œå°±ä¸æ›´ç»†åˆ†æ–‡ä»¶å¤¹äº†ã€‚

```
é¡¹ç›®å/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ modules/
â”‚   â”‚       â”œâ”€â”€ state.js
â”‚   â”‚       â”œâ”€â”€ getters.js
â”‚   â”‚       â””â”€â”€ actions.js
â”‚   â”œâ”€â”€ counter.js
```

#### state.js

é…ç½®çŠ¶æ€ã€‚

```javascript
export const createState = () => ({
    count: 0
});
```

#### getters.js

é…ç½®è®¡ç®—å±æ€§ã€‚

```javascript
export const getters = {
    doubleCount: (state) => state.count * 2
};
```

#### actions .js

é…ç½®ä¿®æ”¹æ–¹æ³•ã€‚

```javascript
export const actions = {
    increment() {
        this.count++;
    }
};
```

#### counter.js

é…ç½®æ ¸å¿ƒå¯¼å…¥æ–‡ä»¶ã€‚

```javascript
import { defineStore } from 'pinia';
import { createState } from './modules/state';
import { getters } from './modules/getters';
import { actions } from './modules/actions';

export const useCounterStore = defineStore('counter', {
    state: () => createState(),
    getters,
    actions
});
```

#### ä½¿ç”¨

å’Œä¸Šé¢çš„ç”¨æ³•ä¸€æ ·çš„ã€‚

åœ¨ç»„ä»¶ä¸­ï¼Œstore çš„ç”¨æ³•ä¸å˜ã€‚

## 3. æ•°æ®è¯·æ±‚

### å®‰è£…å’Œé…ç½® Axios

#### å®‰è£…

```powershell
npm install axios
```

#### Axios é…ç½®

åœ¨ src ä¸‹æ–°å»º api æ–‡ä»¶å¤¹ã€‚

å†…å»º axios.js æ–‡ä»¶ã€‚

ç»™ä¸Šæœ€åŸºæœ¬çš„é…ç½®å³å¯ã€‚

```javascript
import axios from 'axios';

// åˆ›å»º Axios å®ä¾‹
const instance = axios.create({
    baseURL: 'https://api.example.com', // æ›¿æ¢ä¸ºä½ çš„åç«¯ API åŸºç¡€ URL
    timeout: 10000, // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    headers: {
        'Content-Type': 'application/json',
    },
});

// è¯·æ±‚æ‹¦æˆªå™¨
instance.interceptors.request.use(
    (config) => {
        // åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆï¼Œä¾‹å¦‚æ·»åŠ ä»¤ç‰Œ
        console.log("è¿™é‡Œæ˜¯è¯·æ±‚æ‹¦æˆªå™¨");
        return config;
    },
    (error) => {
        // å¤„ç†è¯·æ±‚é”™è¯¯
        return Promise.reject(error);
    }
);

// å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(
    (response) => {
        // å¤„ç†å“åº”æ•°æ®
        console.log("è¿™é‡Œæ˜¯å“åº”æ‹¦æˆªå™¨");
        return response;
    },
    (error) => {
        // å¤„ç†å“åº”é”™è¯¯
        return Promise.reject(error);
    }
);

export default instance;
```

#### å‘é€è¯·æ±‚

é¦–å…ˆï¼Œè¿™ä¸ªå‘é€çš„åœ°å€å¿…é¡»æ˜¯ä¸€ä¸ªå­˜åœ¨çš„ï¼Œå¯ç”¨çš„ã€‚

æˆ‘å°±ç”¨ç°æœ‰çš„ä¸€ä¸ª JavaWeb é¡¹ç›®æ¥ä¸€ä¸‹ã€‚

æ²¡æœ‰çš„è‡ªå·±æƒ³åŠæ³•ï¼šï¼‰ã€‚

```vue
<template>
    <div class="child">
        <h2>Child</h2>
    </div>
</template>

<script>
// å¯¼å…¥ä¸€ä¸‹ axios
import api from '../api/axios';
import { onMounted } from 'vue';

export default {
    name: 'Child',
    setup() {
        // åˆ›å»ºè¯·æ±‚å¯¹è±¡
        const fetchData = async () => {
            try {
                const response = await api.get('http://localhost:8080/list/city');
                console.log('æ•°æ®è·å–æˆåŠŸ:', response.data);
            } catch (error) {
                console.error('æ•°æ®è·å–å¤±è´¥:', error);
            }
        };

        // è¿™é‡Œå°±åœ¨ç»„ä»¶æŒ‚è½½åè‡ªåŠ¨å‘é€
        onMounted(fetchData);

        return { fetchData };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

### æ‹¦æˆªå™¨

ä¸€èˆ¬ä¹Ÿå°±æ˜¯è¯·æ±‚æ‹¦æˆªå™¨ä¸å“åº”æ‹¦æˆªå™¨ä¸¤ç§äº†ã€‚

è¿™é‡Œå°±ä¸ä¸¾ä¾‹äº†ï¼Œè¦ç”¨å•¥è‡ªå·±å»æŸ¥æŸ¥æ€ä¹ˆå†™å°±å¥½äº†ã€‚

åæ­£é•¿å•¥æ ·ä¸Šé¢æœ‰äº†ï¼ŒæŸ¥ä¹Ÿå°±æ˜¯æŸ¥ç»†èŠ‚æ€ä¹ˆå†™äº†ã€‚

#### è¯·æ±‚æ‹¦æˆªå™¨

åœ¨ axios å‘é€è¯·æ±‚ä¹‹å‰ï¼Œå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªã€‚

è¯·æ±‚å‘é€å‰æ‹¦ä½ï¼Œè¿™é‡Œæ˜¯ vue é‡Œé¢æœ€åä¸€ä¸ªè§è¿™ä¸ªè¯·æ±‚çš„ï¼Œå¯ä»¥éšä¾¿æŠ˜è…¾è¿™ä¸ªè¯·æ±‚ã€‚

å¯ä»¥å®ç°å¦‚ï¼š

- æ·»åŠ è¯·æ±‚å¤´
- ä¿®æ”¹è¯·æ±‚å‚æ•°
- æ˜¾ç¤ºåŠ è½½çŠ¶æ€

#### å“åº”æ‹¦æˆªå™¨

åœ¨ axios æ¥æ”¶åˆ°å“åº”åï¼Œå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªã€‚

å“åº”åˆšå›æ¥ï¼Œè¿™é‡Œæ˜¯ vue é‡Œé¢ç¬¬ä¸€ä¸ªè§è¿™ä¸ªå“åº”çš„ï¼Œä¹Ÿæ˜¯å¯ä»¥éšä¾¿æŠ˜è…¾è¿™ä¸ªå“åº”ã€‚

å¯ä»¥å®ç°å¦‚ï¼š

- ç»Ÿä¸€é”™è¯¯å“åº”
- æ•°æ®æ ¼å¼è½¬æ¢
- å…³é—­åŠ è½½çŠ¶æ€

### é”™è¯¯å¤„ç†

ä¸€èˆ¬æœ‰å››ç§åŠæ³•ã€‚

#### æ‹¦æˆªå™¨æ•è·

ç”¨äºå…¨å±€ç»Ÿä¸€å¤„ç†é”™è¯¯ï¼Œå¦‚æ¸…é™¤è¿‡æœŸçš„ token å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢ã€æ˜¾ç¤ºå…¨å±€çš„é”™è¯¯æç¤ºç­‰ã€‚

```javascript
import axios from 'axios';

const instance = axios.create({
    baseURL: 'https://api.example.com',
    timeout: 10000,
    headers: {
        'Content-Type': 'application/json',
    },
});

// å“åº”æ‹¦æˆªå™¨
axios.interceptors.response.use(
    response => response,
    error => {
        // å¤„ç†é”™è¯¯
        if (error.response) {
            // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯å“åº”
            const status = error.response.status;
            switch (status) {
                case 401:
                    // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ token
                    localStorage.removeItem('token');
                    // è·³è½¬åˆ°ç™»å½•é¡µé¢
                    router.push('/login');
                    break;
                case 403:
                    // æ˜¾ç¤ºæ— æƒé™æç¤º
                    console.error('Forbidden');
                    break;
                case 500:
                    // æ˜¾ç¤ºæœåŠ¡å™¨é”™è¯¯æç¤º
                    console.error('Server internal error');
                    break;
            }
        } else if (error.request) {
            // è¯·æ±‚å·²å‘å‡ºä½†æ²¡æœ‰æ”¶åˆ°å“åº”ï¼ˆå¦‚ç½‘ç»œè¿æ¥é—®é¢˜ï¼‰
            console.error('Network error');
        } else {
            // è®¾ç½®è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯
            console.error('Error', error.message);
        }
        return Promise.reject(error);
    }
);

export default instance;
```

#### è¯·æ±‚å¤„æ•è·

å¯¹å•ä¸ªè¯·æ±‚çš„é”™è¯¯è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œæ¯”å¦‚å¯¹æŸäº›ç‰¹å®šæ¥å£çš„é”™è¯¯è¿›è¡Œé‡è¯•ã€æ˜¾ç¤ºç‰¹å®šçš„é”™è¯¯æç¤ºç­‰ã€‚

```vue
<template>
    <div class="child">
        <h2>Child</h2>
    </div>
</template>

<script>
import api from '../api/axios';
import { onMounted } from 'vue';

export default {
    name: 'Child',
    setup() {
        const fetchData = async () => {
            try {
                const response = await api.post('http://localhost:8080/list/city');
                console.log('æ•°æ®è·å–æˆåŠŸ:', response.data);
            } catch (error) {
                if (error.response && error.response.status === 404) {
                    console.error('Resource not found for this API');
                } else {
                    console.error('Request failed in async function:', error);
                }
            }
        };

        onMounted(fetchData);

        return { fetchData };
    }
}
</script>

<style scoped>
.child {
    font-family: 'Arial', sans-serif;
    margin: 20px;
    padding: 20px;
    border: 1px solid #ccc;
}
</style>
```

#### è‡ªå®šä¹‰å¤„ç†

å½“é¡¹ç›®ä¸­æœ‰è®¸å¤šç±»ä¼¼çš„é”™è¯¯å¤„ç†é€»è¾‘æ—¶ï¼Œå¯ä»¥æŠ½å–å‡ºæ¥å½¢æˆè‡ªå®šä¹‰å‡½æ•°ï¼Œä¾¿äºä»£ç å¤ç”¨å’Œç»´æŠ¤ã€‚

##### å®šä¹‰

åœ¨ src ä¸‹åˆ›å»ºä¸€ä¸ª utils æ–‡ä»¶å¤¹ã€‚

åœ¨å†…åˆ›å»ºä¸€ä¸ª errorHandler.js æ–‡ä»¶ã€‚

```javascript
// src/utils/errorHandler.js
export function handleAxiosError(error) {
    let errorMessage = 'An error occurred';
    if (error.response) {
        // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯å“åº”
        switch (error.response.status) {
            case 400:
                errorMessage = 'Bad request';
                break;
            case 401:
                errorMessage = 'Unauthorized';
                break;
            case 403:
                errorMessage = 'Forbidden';
                break;
            case 404:
                errorMessage = 'Resource not found';
                break;
            case 500:
                errorMessage = 'Server internal error';
                break;
            // å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚æ·»åŠ æ›´å¤šè‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†é€»è¾‘
            default:
                errorMessage = `Server error: ${error.response.status}`;
        }
    } else if (error.request) {
        // è¯·æ±‚å·²å‘å‡ºä½†æ²¡æœ‰æ”¶åˆ°å“åº”
        errorMessage = 'Network error or request timeout';
    } else {
        // è®¾ç½®è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯
        errorMessage = `Error: ${error.message}`;
    }
    return errorMessage;
}
```

##### ä½¿ç”¨

ç„¶ååœ¨å¦‚ axios æˆ–è¯·æ±‚å¤„ç­‰åœ°æ–¹ï¼Œå¼•å…¥è¿™ä¸ª js æ–‡ä»¶ï¼Œç„¶åç›´æ¥ä½¿ç”¨å®šä¹‰å¥½çš„æ–¹æ³•å³å¯ã€‚

è¿™é‡Œå±•ç¤ºåœ¨ axios é…ç½®ä¸­ï¼Œç»™å“åº”æ‹¦æˆªå™¨æ¢æˆä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰æ–¹æ³•ã€‚

```javascript
import axios from 'axios';
import { handleAxiosError } from '../utils/errorHandler';

// åˆ›å»º Axios å®ä¾‹
const instance = axios.create({
    baseURL: 'https://api.example.com', // æ›¿æ¢ä¸ºä½ çš„åç«¯ API åŸºç¡€ URL
    timeout: 10000, // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    headers: {
        'Content-Type': 'application/json',
    },
});

// å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(
    response => response,
    error => {
        const errorMessage = handleAxiosError(error);
        console.error(errorMessage);
        return Promise.reject(error);
    }
);

export default instance;
```

#### pinia ç®¡ç†

##### å®šä¹‰

åœ¨ stores æ–‡ä»¶å¤¹ä¸‹åˆ›å»º errorStore.jsã€‚

```javascript
// src/stores/errorStore.js
import { defineStore } from 'pinia';

export const useErrorStore = defineStore('error', {
    state: () => ({
        error: null, // å­˜å‚¨é”™è¯¯ä¿¡æ¯
    }),
    actions: {
        // è®¾ç½®é”™è¯¯ä¿¡æ¯
        setError(errorMessage) {
            this.error = errorMessage;
        },
        // æ¸…é™¤é”™è¯¯ä¿¡æ¯
        clearError() {
            this.error = null;
        },
    },
});
```

##### ä½¿ç”¨

ç„¶åä¹Ÿæ˜¯å…ˆç”¨å“åº”æ‹¦æˆªå™¨ä¸¾ä¾‹ã€‚

```javascript
import axios from 'axios';
import { handleAxiosError } from '../utils/errorHandler';
import { useErrorStore } from '../stores/errorStore';

// åˆ›å»º Axios å®ä¾‹
const instance = axios.create({
    baseURL: 'https://api.example.com', // æ›¿æ¢ä¸ºä½ çš„åç«¯ API åŸºç¡€ URL
    timeout: 10000, // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    headers: {
        'Content-Type': 'application/json',
    },
});

// å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(
    response => {
        // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯çŠ¶æ€
        const errorStore = useErrorStore();
        errorStore.clearError();
        return response;
    },
    error => {
        const errorStore = useErrorStore();
        if (error.response) {
            let errorMessage = '';
            switch (error.response.status) {
                case 400:
                    errorMessage = 'Bad request';
                    break;
                case 401:
                    errorMessage = 'Unauthorized';
                    break;
                case 403:
                    errorMessage = 'Forbidden';
                    break;
                case 404:
                    errorMessage = 'Resource not found';
                    break;
                case 500:
                    errorMessage = 'Server internal error';
                    break;
                default:
                    errorMessage = `Server error: ${error.response.status}`;
            }
            errorStore.setError(errorMessage);
        } else {
            errorStore.setError('Network error or request failed');
        }
        return Promise.reject(error);
    }
);

export default instance;
```
